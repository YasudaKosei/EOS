using UnityEngine;
using System.Collections;
using UnityEngine.UI;
using UnityEngine.SceneManagement;

public class Load : MonoBehaviour
{

	private AsyncOperation async;

	public Text loadingText;
	public Slider loadingBar;

	public static int SL = 0;

	[SerializeField] Fade fade;

	void Start()
	{
		//?????????I???p?[?Z???g???\??
		loadingText.text = "0%".ToString();

		//?????????????o?[???\??
		loadingBar.value = 0;

		//1?b??????FadeOut???ASceneLoad??????????
		fade.FadeOut(1f, () => StartCoroutine("SceneLoad"));
	}

	public IEnumerator SceneLoad()
	{
		//SL???????????????V?[????????????
		if (SL == 0)
		{
			//????Scene2??????????
			async = SceneManager.LoadSceneAsync("Scene2");
		}

		//?????????????V?[????????????elseif???g????????????????
		else if (SL == 1)
		{
			async = SceneManager.LoadSceneAsync("Title");
		}

		else if (SL == 2)
		{
			async = SceneManager.LoadSceneAsync("Ranking");
		}

		else if (SL == 3)
		{
			async = SceneManager.LoadSceneAsync("GameScene");
		}


		//???[?h???????????V?[?????s????????????????
		async.allowSceneActivation = false;

		//????????????????
		while (async.progress < 0.9f)
		{
			//?????????I???p?[?Z???g???\??
			loadingText.text = (async.progress * 100).ToString("f0") + "%";

			//?????????????o?[???\??
			loadingBar.value = async.progress;

			yield return new WaitForSeconds(0);
		}
		//?????????I???p?[?Z???g???\??
		loadingText.text = (async.progress * 100).ToString("f0") + "%";

		//?????????????o?[???\??
		loadingBar.value = async.progress;

		//0.5?b????
		yield return new WaitForSeconds(0.5f);

		//?????????I???p?[?Z???g???\??
		loadingText.text = "100%";

		//?????????????o?[???\??
		loadingBar.value = 1;

		//1?b??????FadeIn???A?V?[?????s??????????
		fade.FadeIn(1f, () => async.allowSceneActivation = true);
	}
}